<div class='order-item' *ngIf='order'>
  <ng-container *ngIf='order.OrderFlightTickets?.length'>
    <ng-container *ngIf='order.OrderFlightTickets?.length'>
      <div class="item">
        <div>编号</div>
        <div class="select-text">
          <span style="font-weight: bold;">{{order.Id}}</span>
          <span *ngIf='order.InsertDateTime'>({{order.InsertDateTime?.replace("T"," ")?.substr(0,19)}})</span>
        </div>
      </div>
      <div class="item">
        <div [style.align-self]='order["checkPay"]?"center":""'>金额</div>
        <div style="display: flex;align-items: center;">
          <ion-text color='danger'>
            <span>
              ￥{{getFlightOrderTotalAmount()}}
            </span>
            <span *ngIf='order.OrderInsurances?.length'>
              (含保险)</span>
          </ion-text>
          <span>
            <ion-text color='secondary'>
              ({{order.StatusName == "等待处理" ? "等待审批" : order.StatusName}})
            </ion-text>
          </span>
          <ng-container *ngIf='order["checkPay"]'>
            <ion-button (click)='onPay($event)' size='small' color='secondary'>去支付
            </ion-button>
          </ng-container>
        </div>
      </div>
      <ng-container *ngFor='let t of order.OrderFlightTickets;let i=index;'>
        <ng-container *ngIf='t.VariablesJsonObj&&t.VariablesJsonObj["isShow"]'>
          <div class="order-flight-ticket">
            <ng-container *ngFor='let trip of t.OrderFlightTrips ;let first=first;'>
              <div class="item" style='align-items: center;'
                *ngIf='t.TicketType==OrderFlightTicketType.International?first:true'>
                <div>
                  <ng-container *ngIf='t.VariablesJsonObj.idx else aa'>
                    旅客{{t.VariablesJsonObj.idx}}
                  </ng-container>
                  <ng-template #aa>
                    旅客
                  </ng-template>
                </div>
                <div>
                  <span>{{trip.OrderFlightTicket.Passenger.CheckName}}</span>
                  <span>
                    <ion-text color='secondary'>({{t.StatusName}})</ion-text>
                  </span>
                </div>
                <ion-button *ngIf='showRefundBtn(t)' (click)='onRefundFlightTicket($event,t)' color='danger'>
                  <ion-text color='light'>退票</ion-text>
                </ion-button>
              </div>
              <div class="item">
                <div>
                  <span *ngIf='t.TicketType==OrderFlightTicketType.International?first:true'>
                    行程
                  </span>
                </div>
                <div>
                  <div>
                    <span>
                      {{trip.TakeoffDate}}
                    </span>
                    <span *ngIf='getDateWeekName(trip.TakeoffDate) as n'>
                      ({{n}})
                    </span>
                    <span>
                      {{trip.TakeoffShortTime}}
                    </span>
                    <span>
                      {{trip.FlightNumber}}
                    </span>
                  </div>
                  <div>
                    {{trip.FromCityName}}---{{trip.ToCityName}}
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
  <ng-container *ngIf='order.OrderTrainTickets?.length'>
    <ng-container *ngFor='let orderTrainTicket of order.OrderTrainTickets'>
      <ion-grid class="train">
        <ion-row>
          <ion-col size='4'>
            订单编号
          </ion-col>
          <ion-col class='select-text' class='dark'>
            <strong>{{order.Id}}</strong>
          </ion-col>
          <ion-col class='status'>
            <ion-text color='secondary'>
              {{order.StatusName == "等待处理" ? "等待审批" : order.StatusName}}</ion-text>
          </ion-col>
        </ion-row>
        <ng-container *ngIf='orderTrainTicket.OrderTrainTrips'>
          <ion-row>
            <ion-col size='4'>
              <ion-text color='ticketIsReject(orderTrainTicket)?"danger":""'>火车票事务号</ion-text>
            </ion-col>
            <ion-col class='select-text'>
              <ion-text color='ticketIsReject(orderTrainTicket)?"danger":""'>
                {{orderTrainTicket.Id}}</ion-text>
            </ion-col>
          </ion-row>
        </ng-container>
        <ion-row *ngIf='order?.OrderPassengers?.length'>
          <ion-col size='4'>旅客信息</ion-col>
          <ion-col>
            <ng-container *ngIf='orderTrainTicket.Passenger as p'>
              {{p.CheckName}}
              <span class='ion-margin-start'>{{p.CredentialsNumber}}</span>
            </ng-container>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'>行程信息</ion-col>
          <ion-col>
            <div>
              <div *ngFor='let orderTrainTrip of orderTrainTicket.OrderTrainTrips'>
                <span>{{orderTrainTrip.StartTime?.substr(0,"yyyy-mm-dd".length)}}</span>
                <span style='margin-left:0.5em'>{{getHHmm(orderTrainTrip.StartTime)}}</span>
                <span>{{orderTrainTrip.TrainNo}}</span>
                <div>{{orderTrainTrip.FromStationName}}---{{orderTrainTrip.ToStationName}}</div>
              </div>
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'>
            车票状态
          </ion-col>
          <ion-col>
            {{orderTrainTicket.StatusName}}
          </ion-col>
          <ion-col class="ion-padding-end ion-text-end">
            <ion-text color='danger'>
              ￥{{getTotalAmount(order,orderTrainTicket.Key) + trainInsuranceAmount(orderTrainTicket)}}
              <span *ngIf="trainInsuranceAmount(orderTrainTicket) as amount">(含保险{{amount}})</span>
            </ion-text>
          </ion-col>
        </ion-row>
        <ion-row class='ion-text-end' *ngIf='check(orderTrainTicket)'>
          <ion-col style="justify-content: flex-end;">
            <ion-button (click)='onExchange($event,orderTrainTicket)' color='secondary'
              *ngIf='orderTrainTicket.Status == OrderTrainTicketStatusType.Issued && tmc?.TrainIsAllowExchange && TrainSupplierType[orderTrainTicket.Supplier] !="0" && orderTrainTicket.BookType != TrainBookType.Offline'>
              <span>改签</span>
            </ion-button>
            <ion-button (click)='onRefundTrainTicket($event,orderTrainTicket)' color='secondary'
              *ngIf='(orderTrainTicket.Status == OrderTrainTicketStatusType.Issued || orderTrainTicket.Status == OrderTrainTicketStatusType.Exchanged) 
          &&  tmc?.TrainIsAllowRefund && TrainSupplierType[orderTrainTicket.Supplier] !="0" && orderTrainTicket.BookType != TrainBookType.Offline'>
              <span>退票</span>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ng-container>
  </ng-container>
  <ng-container *ngIf='order.OrderHotels?.length'>
    <ng-container *ngFor='let  orderHotel of order.OrderHotels'>
      <ion-grid class="hotel">
        <ion-row>
          <ion-col size='3'>
            订单编号
          </ion-col>
          <ion-col class='select-text' class='dark'>
            <strong>{{order.Id}}</strong>
          </ion-col>
          <ion-col class='status'>
            <ion-text color='secondary'>
              {{order.StatusName == "等待处理" ? "等待审批" : order.StatusName}}</ion-text>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='3'>
            事务号
          </ion-col>
          <ion-col class='select-text'>
            {{orderHotel.Id}}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='3'>
            酒店名称
          </ion-col>
          <ion-col>
            {{orderHotel.HotelName}}
          </ion-col>
        </ion-row>
        <ion-row *ngIf='order?.OrderPassengers?.length'>
          <ion-col size='3'>旅客信息</ion-col>
          <ion-col>
            <ng-container *ngIf='orderHotel.Passenger as p'>
              {{p.CheckName}} <span class='ion-margin-start'>{{p.CredentialsNumber}}</span>
            </ng-container>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='3'>
            入住时间
          </ion-col>
          <ion-col>
            {{orderHotel.BeginDate?.substr(0,"yyyy-MM-dd".length)}}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='3'>
            离店时间
          </ion-col>
          <ion-col>
            {{orderHotel.EndDate?.substr(0,"yyyy-MM-dd".length)}}
          </ion-col>
        </ion-row>
        <ion-row *ngIf='order.TotalAmount as m'>
          <ion-col size='3'>
            房费
          </ion-col>
          <ion-col>
            <ion-text color='danger'>
              ￥{{m}}
            </ion-text>
            <ion-text color='medium'>
              {{order.TravelPayType==2?"(现付)":order.TravelPayType==1?"(预付)":""}}
            </ion-text>
          </ion-col>
        </ion-row>
        <ion-row *ngIf='orderHotel.ConfirmNumber as cnumber'>
          <ion-col size='3'>
            酒店确认号
          </ion-col>
          <ion-col>
            {{cnumber}}
          </ion-col>
        </ion-row>
        <ion-row *ngIf='false'>
          <ion-col *ngIf='false'>
            <ion-text color='danger'>￥{{getTotalAmount(order,orderHotel.Key)}}</ion-text>
          </ion-col>
          <ion-col>
            {{orderHotel.StatusName}}
            <ion-button
              *ngIf='false&&orderHotel.Status == OrderHotelStatusType.PayFailure && orderHotel.PaymentType == HotelPaymentType.SelfPay'>
              重新担保</ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ng-container>
  </ng-container>
  <ng-container *ngIf='order.OrderCars?.length'>
    <app-car-item [order]="order"></app-car-item>
  </ng-container>
</div>