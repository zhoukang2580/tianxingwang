<div class='order-item' *ngIf='order'>
  <ion-row>
    <ion-col>
      <strong style="margin-right: 0.5em;">{{order.Id}}</strong>
      <span *ngIf='order.InsertDateTime'>完成时间:{{order.InsertDateTime}}</span>
      <ion-text color='secondary' style="margin-left: auto;margin-right: 1em;">
        {{order.StatusName == "等待处理" ? "等待审批" : order.StatusName}}</ion-text>
      <ng-container *ngIf='checkPay()'>
        <ion-buttons>
          <ion-button (click)='onPay($event)' size='small' color='secondary'
            style="font-size: .8rem;margin-left: auto;margin-right: 0em;">现在去支付
          </ion-button>
        </ion-buttons>
      </ng-container>
    </ion-col>
  </ion-row>
  <ion-row *ngIf='order?.OrderPassengers?.length'>
    <ion-col>
      <ion-label text-wrap>
        <span *ngFor='let p of order.OrderPassengers'>
          {{p.CheckName}}
          {{p.CredentialsNumber}}
        </span>
      </ion-label>
    </ion-col>
  </ion-row>
  <ng-container *ngFor='let orderFlightTicket of order.OrderFlightTickets' class='order-flight-trip'>
    <ng-container *ngFor='let orderFlightTrip of orderFlightTicket.OrderFlightTrips'>
      <ion-row>
        <ion-col>
          <ion-text color='ticketIsReject(orderFlightTicket)?"danger":""'>机票事务号:</ion-text>
        </ion-col>
        <ion-col>
          <ion-text color='ticketIsReject(orderFlightTicket)?"danger":""'>{{orderFlightTicket.Id}}</ion-text>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-label>
            <div *ngFor='let  orderFlightTrip of orderFlightTicket.OrderFlightTrips'>
              <ng-container *ngIf='orderFlightTrip.Status == OrderFlightTripStatusType.Normal'>
                <span>{{orderFlightTrip.TakeoffTime?.substr(0,"yyyy-mm-dd".length)}}</span>
                <span>{{orderFlightTrip.FromCityName}}←→{{orderFlightTrip.ToCityName}}</span>
                <span>{{orderFlightTrip.FlightNumber}}</span>
                <span>{{getHHmm(orderFlightTrip.TakeoffTime)}}</span>
              </ng-container>
            </div>
          </ion-label>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-text color='danger'>
            ￥{{getTotalAmount(order,orderFlightTicket.Key) + flightInsuranceAmount(orderFlightTicket)}}
            <span *ngIf='flightInsuranceAmount(orderFlightTicket) as insuranceAmount'>(含保险{{insuranceAmount}})</span>
          </ion-text>
        </ion-col>
        <ion-col>
          {{orderFlightTicket.StatusName}}
          <ion-button *ngIf='"客户PC 代理PC 客户H5 代理H5 Android IOS 代理Android 代理IOS 代理接口".includes(orderFlightTicket.Order?.Channel)
            &&
            orderFlightTicket.Status == OrderFlightTicketStatusType.Issued
            &&  
            tmc?.FlightIsAllowRefund 
            && (orderFlightTicket.Supplier !="0")
            ' color='danger'>退票
          </ion-button>
        </ion-col>
      </ion-row>
    </ng-container>
  </ng-container>
  <ng-container *ngIf='order.OrderTrainTickets?.length'>
    <ng-container *ngFor='let orderTrainTicket of order.OrderTrainTickets'>
      <ng-container *ngIf='orderTrainTicket.OrderTrainTrips'>
        <ion-row>
          <ion-col>
            <ion-text color='ticketIsReject(orderTrainTicket)?"danger":""'>火车票事务号:</ion-text>
          </ion-col>
          <ion-col>
            <ion-text color='ticketIsReject(orderTrainTicket)?"danger":""'>{{orderTrainTicket.Id}}</ion-text>
          </ion-col>
        </ion-row>
      </ng-container>
      <ion-row>
        <ion-col>
          <ion-label>
            <div *ngFor='let orderTrainTrip of orderTrainTicket.OrderTrainTrips'>
              <span>{{orderTrainTrip.StartTime?.substr(0,"yyyy-mm-dd".length)}}</span>
              <span>{{orderTrainTrip.FromStationName}}---{{orderTrainTrip.ToStationName}}</span>
              <span>{{orderTrainTrip.TrainNo}}</span>
              <span>{{getHHmm(orderTrainTrip.StartTime)}}</span>
            </div>
          </ion-label>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-text color='danger'>
            ￥{{getTotalAmount(order,orderTrainTicket.Key) + trainInsuranceAmount(orderTrainTicket)}}
            <span *ngIf="trainInsuranceAmount(orderTrainTicket) as amount">(含保险{{amount}})</span>
          </ion-text>
        </ion-col>
        <ion-col>
          {{orderTrainTicket.StatusName}}
          <ion-button (click)='onExchange($event,orderTrainTicket)' color='secondary'
            *ngIf='false && orderTrainTicket.Status == OrderTrainTicketStatusType.Issued && tmc?.TrainIsAllowExchange && TrainSupplierType[orderTrainTicket.Supplier] !=0 && orderTrainTicket.BookType != TrainBookType.Offline'>
            <span>改签</span>
          </ion-button>
          <ion-button (click)='onRefund($event,orderTrainTicket)' color='secondary'
            *ngIf='(orderTrainTicket.Status == OrderTrainTicketStatusType.Issued || orderTrainTicket.Status == OrderTrainTicketStatusType.Exchanged) 
          &&  tmc?.TrainIsAllowRefund && TrainSupplierType[orderTrainTicket.Supplier] !="0" && orderTrainTicket.BookType != TrainBookType.Offline'>
            <span>退票</span>
          </ion-button>

        </ion-col>
      </ion-row>
    </ng-container>
  </ng-container>
  <ng-container *ngIf='order.OrderHotels?.length'>
    <ng-container *ngFor='let  orderHotel of order.OrderHotels'>
      <ion-row>
        <ion-col>
          酒店事务号
        </ion-col>
        <ion-col>
          {{orderHotel.Id}}
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          酒店名称
        </ion-col>
        <ion-col>
          {{orderHotel.HotelName}}
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <div margin-end>
            入住:{{orderHotel.BeginDate?.substr(0,"yyyy-MM-dd".length)}}
          </div>
          <div margin-start>
            离店:{{orderHotel.EndDate?.substr(0,"yyyy-MM-dd".length)}}
          </div>
          <div *ngIf='orderHotel.ConfirmNumber as cnumber'>
            酒店确认号:{{cnumber}}
          </div>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col *ngIf='false'>
          <ion-text color='danger'>￥{{getTotalAmount(order,orderHotel.Key)}}</ion-text>
        </ion-col>
        <ion-col>
          {{orderHotel.StatusName}}
          <ion-button
            *ngIf='false&&orderHotel.Status == OrderHotelStatusType.PayFailure && orderHotel.PaymentType == HotelPaymentType.SelfPay'>
            重新担保</ion-button>
        </ion-col>
      </ion-row>
    </ng-container>
  </ng-container>
</div>