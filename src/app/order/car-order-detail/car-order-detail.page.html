<ion-header>
  <ion-toolbar>
    <ion-buttons slot='start'>
      <app-back-button></app-back-button>
    </ion-buttons>
    <ion-title>用车订单详情</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <app-swiper-slide-content [tabs]="tabs">
    <div class="swiper-slide">
      <!-- 基础信息 -->
      <div>
        <ion-item-divider>
          {{tabs[0].label}}
        </ion-item-divider>
        <ion-row>
          <ion-col size='4'>订单编号</ion-col>
          <ion-col> {{orderDetail?.Order?.Id}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'>集团名称</ion-col>
          <ion-col> {{tmc?.Name}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'> 应收金额</ion-col>
          <ion-col> {{getTotalAmount(orderDetail?.Order)}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'> 已付金额</ion-col>
          <ion-col> {{getPayAmount(orderDetail?.Order)}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'> 订单状态</ion-col>
          <ion-col> {{orderDetail?.Order?.StatusName == "等待处理" ? "等待审批" : orderDetail?.Order?.StatusName}}</ion-col>
          <ion-col *ngIf='true||orderDetail?.Order.Status == OrderStatusType.WaitPay'>
            <ion-button color='secondary' slot='end' (click)='onPay()'>
              现在去支付</ion-button>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'> 订单来源</ion-col>
          <ion-col> {{orderDetail?.Order?.Channel}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size='4'> 付款方式</ion-col>
          <ion-col> {{orderDetail?.TravelType}}-{{orderDetail?.TravelPayType}}</ion-col>
        </ion-row>
      </div>
    </div>
    <div class="swiper-slide">
      <!-- 用车信息 -->
      <div>
        <ion-item-divider>
          {{tabs[1].label}}
        </ion-item-divider>
        <div *ngFor='let orderCar of orderDetail?.Order.OrderCars'>
          <ion-row>
            <ion-col size='4'>实际出发地址</ion-col>
            <ion-col>
              <div>
                {{orderCar.ActualFromAddress}}
                <div>{{orderCar.FromTime?.substr(0,19)?.replace("T"," ")}}</div>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>实际目的地址</ion-col>
            <ion-col>
              <div>
                {{orderCar.ActualToAddress}}
                <div>{{orderCar.ArriveTime?.substr(0,19)?.replace("T"," ")}}</div>
              </div>
            </ion-col>
          </ion-row>
        </div>
      </div>
    </div>
    <div class="swiper-slide">
      <!-- 乘客信息 -->
      <div>
        <ion-item-divider>
          {{tabs[2].label}}
        </ion-item-divider>
        <div *ngFor='let p of orderDetail?.Order?.OrderPassengers'>
          <ion-row>
            <ion-col size='4'>姓名</ion-col>
            <ion-col>
              {{p.Name}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>证件类型</ion-col>
            <ion-col>
              {{p.CredentialsTypeName}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>证件号</ion-col>
            <ion-col>
              {{p.CredentialsNumber}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>性别</ion-col>
            <ion-col>
              {{p.Gender == "F" ? "女" : "男"}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>生日</ion-col>
            <ion-col>
              {{p.Birthday?.substr(0,10)}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>国籍</ion-col>
            <ion-col>
              {{p.IssueCountry}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>证件到期日</ion-col>
            <ion-col>
              {{p.ExpirationDate?.substr(0,10)}}
            </ion-col>
          </ion-row>
        </div>
      </div>
    </div>
    <div class="swiper-slide">
      <!-- 联系信息 -->
      <div>
        <ion-item-divider>
          {{tabs[3].label}}
        </ion-item-divider>
        <div *ngFor='let p of orderDetail?.Order?.OrderPassengers'>
          <ion-row>
            <ion-col size='4'>类型</ion-col>
            <ion-col>乘客</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>姓名</ion-col>
            <ion-col>{{p.Name}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>邮箱</ion-col>
            <ion-col>{{p.Email}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>电话</ion-col>
            <ion-col>{{p.Mobile}}</ion-col>
          </ion-row>
        </div>
        <div *ngFor='let p of orderDetail?.Order?.OrderLinkmans'>
          <ion-row>
            <ion-col size='4'>类型</ion-col>
            <ion-col>
              联系人
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>姓名</ion-col>
            <ion-col>{{p.Name}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>邮箱</ion-col>
            <ion-col>{{p.Email}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>电话</ion-col>
            <ion-col>{{p.Mobile}}</ion-col>
          </ion-row>
        </div>
      </div>
    </div>
    <div class="swiper-slide">
      <div>
        <!-- 用车价格信息 -->
        <ion-item-divider>
          {{tabs[4].label}}
        </ion-item-divider>
        <div *ngFor='let orderCar of orderDetail?.Order.OrderCars'>
          <ion-row>
            <ion-col size='4'>用车事务号</ion-col>
            <ion-col>{{orderCar.Id}}</ion-col>
            <ion-col>{{orderCar.StatusName}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>应收金额</ion-col>
            <ion-col> {{getTotalAmountByKey(orderDetail?.Order,orderCar.Key)}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>用车金额</ion-col>
            <ion-col> {{getUseCarAmount(orderDetail?.Order,orderCar.Key)}}</ion-col>
          </ion-row>
          <ion-row *ngIf='tmc?.IsShowServiceFee'>
            <ion-col size='4'>服务费</ion-col>
            <ion-col> {{getFeeAmount(orderDetail?.Order,orderCar.Key)}}</ion-col>
          </ion-row>

          <ion-row>
            <ion-col size='4'>其它费用</ion-col>
            <ion-col> {{getOtherAmount(orderDetail?.Order,orderCar.Key)}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>违规</ion-col>
            <ion-col> {{orderCar.OrderTravel?.IllegalPolicy}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>违规原因</ion-col>
            <ion-col> {{orderCar.OrderTravel?.IllegalReason}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col size='4'>成本中心</ion-col>
            <ion-col> {{orderCar.OrderTravel?.CostCenterCode}}-{{orderCar.OrderTravel?.CostCenterName}}
              <ng-container *ngFor='let number of getOrderNumbers()'>
                <span>{{number.Name}}</span>
                <span class="ion-margin-start">{{number.Number}}</span>
              </ng-container>
            </ion-col>
          </ion-row>
          <ion-row *ngIf="getVariableObj(orderCar,'ExceptionMessage') as exmsg">
            <ion-col size='4'>异常消息</ion-col>
            <ion-col> {{exmsg}}
            </ion-col>
          </ion-row>

        </div>
      </div>
    </div>
    <div class="swiper-slide">
      <!-- 审批记录 -->
      <div>
        <ion-item-divider>
          {{tabs[5].label}}
        </ion-item-divider>
        <div>
          <app-timeline [hideLastTimeLineTail]='false' *ngIf='orderDetail?.Histories'>
            <app-timeline-item *ngFor='let history of orderDetail.Histories'>
              <div class='approval-info'>
                <ion-label>审批类型：{{getVariableObj(history,"TypeName")}}</ion-label>
                <ion-label>审批人：{{history.Account?.RealName}} <span
                    *ngIf='history.StatusName'>({{history.StatusName}})</span>
                </ion-label>
                <ion-label>发起审批时间：{{history?.InsertDateTime}}</ion-label>
                <ion-label>审批截止时间：{{history?.ExpiredTime?.startsWith("1800")?"":history?.ExpiredTime}}</ion-label>
              </div>
            </app-timeline-item>
          </app-timeline>
        </div>
      </div>
    </div>
  </app-swiper-slide-content>
</ion-content>