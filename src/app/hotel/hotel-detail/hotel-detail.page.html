<div class='header' #header>
  <ion-toolbar>
    <ion-buttons slot='start'>
      <ion-button color='dark' (click)='back()'>
        <ion-icon name='arrow-back'></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{hotel?.Name}}</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment (ionChange)="segmentChanged($event)" color="secondary">
      <ion-segment-button value="houseInfo" [checked]='activeTab=="houseInfo"'>
        <ion-label>房型</ion-label>
      </ion-segment-button>
      <ion-segment-button value="hotelInfo" [checked]='activeTab=="hotelInfo"'>
        <ion-label>酒店信息</ion-label>
      </ion-segment-button>
      <ion-segment-button value="trafficInfo" [checked]='activeTab=="trafficInfo"'>
        <ion-label>交通信息</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</div>
<ion-content>
  <ion-refresher slot='fixed' (ionRefresh)='doRefresh()'></ion-refresher>
  <div class='bg' #bgPic (click)='isShowImages=true' [class.md]='isMd'>
    <ion-icon class='back-arrow' name="arrow-back" *ngIf='isShowBackArrow' (click)='back()' color='{{backArrowColor}}'>
    </ion-icon>
    <ion-chip *ngIf='hotel?.HotelImages?.length as len'>
      1/{{len}}
    </ion-chip>
  </div>
  <ion-card *ngIf='hotel else fakeCard'>
    <ion-card-header>
      <ion-label>
        <h2>
          <strong>
            {{hotel?.Name}}
          </strong>
        </h2>
      </ion-label>
    </ion-card-header>
    <ion-card-subtitle padding-start>
      <div class='grade-stars'>
        <span>{{hotel?.Grade}}</span>
        <div class='stars' *ngIf='getStars(hotel) as stars'>
          <ng-container *ngFor='let s of stars'>
            <ion-icon name="star" color='danger' *ngIf='s>=1'></ion-icon>
            <ion-icon name='star-half' color='danger' *ngIf='s<1'></ion-icon>
          </ng-container>
        </div>
      </div>
      <ion-item (click)='onOpenMap()' lines='none' no-margin no-padding>
        <ion-label color='secondary'>{{hotel?.Address}}</ion-label>
        <ion-icon name="pin" color='secondary'></ion-icon>
      </ion-item>
    </ion-card-subtitle>
    <ion-card-content>
      <div class='date' (click)="onOpenCalendar()">
        <div class='checkinoutdate'>{{queryModel?.checkInDate}} <span
            class='weekName'>{{getWeekName(queryModel?.checkOutDate)}}</span></div>
        <div>共{{totalNights}}晚</div>
        <div class='checkinoutdate'>{{queryModel?.checkOutDate}} <span
            class='weekName'>{{getWeekName(queryModel?.checkOutDate)}}</span></div>
      </div>
      <ion-button (click)='onSearch()' color='secondary' expand='block'>搜索</ion-button>
    </ion-card-content>
  </ion-card>
  <ng-template #fakeCard>
    <ion-card>
      <ion-card-header>
        <ion-skeleton-text style="height: 1.25em;width:80%"></ion-skeleton-text>
      </ion-card-header>
      <ion-card-subtitle padding-start>
        <ion-skeleton-text style="height: 1.25em;width:40%;margin-left: 1em;"></ion-skeleton-text>
      </ion-card-subtitle>
      <ion-card-content>
        <div class='date'>
          <ion-skeleton-text style="height: 1em;width:40%"></ion-skeleton-text>
          <ion-skeleton-text style="height: 1em;width:40%"></ion-skeleton-text>
        </div>
        <ion-button [disabled]='true' color='secondary' expand='block'>搜索</ion-button>
      </ion-card-content>
    </ion-card>
  </ng-template>
  <ion-list class='room-list' #houseInfo>
    <ion-item-divider sticky>房型信息</ion-item-divider>
    <ion-item *ngFor='let room of hotel?.Rooms'>
      <ion-thumbnail (click)='onShowRoomImages(room)'>
        <ng-container *ngIf='getRoomImages(room) as images'>
          <img [lazyloadImage]='images[0]?.replace("Mobile640_960", "Hotel70_70")' appLazyloadimage />
          <div class='images-nums' *ngIf='images.length as len'>{{len}}张</div>
        </ng-container>
      </ion-thumbnail>
      <ion-label (click)='onShowRoomDetails(room)' class='item'>
        <h3 class='name'>
          <ion-label>{{room.Name}}</ion-label>
          <ion-text color='danger' *ngIf='getRoomLowestAvgPrice(room) as price'><strong>￥{{price}}起</strong></ion-text>
        </h3>
        <h4 *ngIf='room.RoomDetails'>
          <ion-label text-wrap>
            <div class="room-detail-desc">
              <span *ngIf='getRoomArea(room) as it'>{{it.Description}}m²</span>
              <span *ngIf='getBedType(room) as it'>{{it.Description}}</span>
              <span *ngIf='getCapacity(room) as it'>可住{{it.Description}}人</span>
              <span *ngIf='getComments(room) as it'>{{it.Description}}</span>
            </div>
          </ion-label>
        </h4>
        <h3 text-end>
          <ion-button color='secondary' size='small'>预订</ion-button>
        </h3>
      </ion-label>
    </ion-item>
  </ion-list>
  <ion-list #hotelInfo class='hotel-info'>
    <ion-item-divider sticky>酒店信息</ion-item-divider>
  </ion-list>
  <ion-list #trafficInfo class='traffic-info'>
    <ion-item-divider sticky>交通信息</ion-item-divider>
    <div class="traffic-map">
      <app-map [lat]='hotel?.Lat' [lng]='hotel?.Lng'></app-map>
    </div>
  </ion-list>
</ion-content>
<app-browse-images *ngIf="isShowImages" [images]='getImageUrls()' (close)='isShowImages=false'></app-browse-images>
<app-browse-images *ngIf="isShowRoomImages" [images]="roomImages" (close)='isShowRoomImages=false'></app-browse-images>
<app-room-detail [room]='curSelectedRoom' [roomImages]='roomImages' (close)='isShowRoomDetails=false' class="ion-page"
  *ngIf='isShowRoomDetails' (bookRoom)='onBookRoomPlan($event)'></app-room-detail>