<ion-header>
  <ion-toolbar>
    <ion-buttons slot='start'>
      <app-back-button defaultHref=''></app-back-button>

    </ion-buttons>
    <ion-title>证件管理</ion-title>
    <ion-buttons slot='end' class='ion-padding-end'>
      <ion-button *ngIf='!modifyCredential' fill='solid' (click)='onAddCredential()' size='small' color='secondary'>
        新增
      </ion-button>
      <ion-button size='small' *ngIf='modifyCredential' fill='solid' (click)='onSaveCredential(modifyCredential)'
        color='secondary'>
        完成
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <app-refresher slot="fixed" (ionRefresh)="doRefresh()">
    <ion-refresher-content 
      refreshingText="正在加载...">
    </ion-refresher-content>
  </app-refresher>
  <div class="container ion-margin-top ">
    <div class="credential">
      <div [attr.dataid]='c.Id' #addForm *ngIf='modifyCredential as c'>
        <div class="item">
          <div>
            姓
          </div>
          <div>
            <input type="text" [(ngModel)]='c.FirstName' placeholder="请输入您的姓" ValidateName='FirstName' name='FirstName'>
          </div>
        </div>
        <div class="item">
          <div>
            名
          </div>
          <div>
            <input type="text" [(ngModel)]='c.LastName' ValidateName='LastName' placeholder="请输入您的名" name='LastName'>
          </div>
        </div>
        <div class="item">
          <div>
            登机姓
          </div>
          <div>
            <input type="text" [(ngModel)]='c.CheckFirstName' [attr.dataid]='c.Id' placeholder="请输入您的登机姓"
              ValidateName='CheckFirstName' name='CheckFirstName'>
          </div>
        </div>
        <div class="item ">
          <div>
            登机名
          </div>
          <div>
            <input type="text" [(ngModel)]='c.CheckLastName' [attr.dataid]='c.Id' placeholder="请输入您的登机名"
              ValidateName='CheckLastName' name='CheckLastName'>
          </div>
        </div>
        <div class="gap"> </div>
        <div class="item">
          <div>
            性别
          </div>
          <div>
            <ion-radio-group class='ion-no-margin ion-no-padding gender' [(ngModel)]='c.Gender' name='Gender'>
              <ion-radio id='man' value="M" ></ion-radio>
              <ion-label for='man' slot='start'>男</ion-label>
              <ion-label class='ion-margin-start ion-padding-start'></ion-label>
              <ion-radio id='nv' value="F"></ion-radio>
              <ion-label for='nv'>女</ion-label>
            </ion-radio-group>
          </div>
        </div>
        <div class="item" (click)='onSelectIdType(idtypeSelectEle)'>
          <div>
            证件类型
          </div>
          <div>
            <span>{{c.Type|credential}}</span>
          </div>
          <div class="arrow-dropdown">
            <ion-icon name='caret-down-outline' color='secondary' mode='md'></ion-icon>
          </div>
          <div class='hidden'>
            <ion-select #idtypeSelectEle [(ngModel)]='c.Type' placeholder='请选择证件类型' (ionChange)='onIdTypeChange()'
              name='Type' okText="确定" cancelText="取消" [compareWith]='compareFn'>
              <ion-select-option [value]="opt.key" *ngFor='let opt of identityTypes'>{{opt.key|credential}}
              </ion-select-option>
            </ion-select>
            <input type="text" value="{{c.Type}}" class='hidden' ValidateName="Type">
          </div>
        </div>
        <div class="item">
          <div>
            证件号码
          </div>
          <div>
            <input placeholder='请输入您的证件号' type="text" [(ngModel)]='c.Number' name='Number' #idInput
              ValidateName="Number">
          </div>
        </div>
        <div class="item" (click)='onSelectBirthDate()'>
          <div>
            出生年月
          </div>
          <div [class.placeholder]='!c.Birthday'>
            <span *ngIf='!c.Birthday'>请选择日期</span>
            <span *ngIf='c.Birthday as d'>{{d}}</span>
            <input type="date" class='hidden'  [(ngModel)]='c.Birthday' name='Birthday'
              ValidateName="Birthday">
          </div>
          <div class="arrow-forward ion-text-end">
            <ion-icon name="chevron-forward-outline" size='small' color='medium' mode='ios'></ion-icon>
          </div>
        </div>
        <div class="item" (click)='onSelectExpireDate()'>
          <div>
            证件到期日期
          </div>
          <div [class.placeholder]='!c.ExpirationDate'>
            <span *ngIf='!c.ExpirationDate'>请选择日期</span>
            <span *ngIf='c.ExpirationDate as d'>{{d}}</span>
          </div>
          <div class="arrow-forward ion-text-end">
            <input type="date" class="hidden"  [(ngModel)]='c.ExpirationDate' name='ExpirationDate'
              ValidateName="ExpirationDate">
            <ion-icon name="chevron-forward-outline" size='small' color='medium' mode='ios'></ion-icon>
          </div>
        </div>
        <div class="gap"> </div>
        <div class="item" (click)='selectIdentityNationality(c,$event)'>
          <div>
            国籍
          </div>
          <div>
            {{c.Country}}
          </div>
          <div class="arrow-forward">
            <ion-icon name="chevron-forward-outline" size='small' color='medium' mode='ios'></ion-icon>
          </div>
        </div>
        <div class="item" (click)='selectIssueNationality(c,$event)'>
          <div>
            发证国籍
          </div>
          <div>
            {{c.IssueCountry}}
          </div>
          <div class="arrow-forward">
            <ion-icon name="chevron-forward-outline" size='small' color='medium' mode='ios'></ion-icon>
          </div>
        </div>
        <div class="gap"></div>
      </div>
      <form #form [class.hidden]='modifyCredential'>
        <ng-container *ngIf='!loading else loadingTemp'>
          <div class='ion-margin-top' *ngFor='let c of credentials;' [attr.dataid]='c.Id'>
            <div>
              <div class="item">
                <div>
                  姓名
                </div>
                <div>
                  {{c.FirstName}}{{c.LastName}}
                </div>
              </div>
              <div class='item '>
                <div>登机名</div>
                <div>{{c.CheckName}}</div>
              </div>
              <div class="gap"></div>
              <div class="item">
                <div>性别</div>
                <div>{{c.Gender=="M"?"男":"女"}}</div>
              </div>
              <div class="item">
                <div>证件类型</div>
                <div>{{c.Type|credential}}</div>
              </div>
              <div class="item">
                <div>证件号码</div>
                <div>{{c.Number}}</div>
              </div>
              <div class="item">
                <div>出生年月</div>
                <div>{{c.Birthday}}</div>
              </div>
              <div class="item ">
                <div>证件到期日期</div>
                <div>{{c.ExpirationDate}}</div>
              </div>
              <div class="gap"></div>
              <div class="item">
                <div>国籍</div>
                <div>{{c.Country}}</div>
              </div>
              <div class="item ">
                <div>发证国籍</div>
                <div>{{c.IssueCountry}}</div>
              </div>
            </div>
            <div class="gap"></div>
            <div class="item btns">
              <ion-button fill='clear' color='danger' expand='block' szie='small' (click)='removeExistCredential(c)'>
                <ion-text>删除证件</ion-text>
              </ion-button>
              <span class="line">|</span>
              <ion-button fill='clear' color='secondary' szie='small' expand='block' (click)='togleModify(c)'>
                <ion-text>修改信息</ion-text>
              </ion-button>
            </div>
          </div>
        </ng-container>
      </form>
    </div>
  </div>
  <ng-template #loadingTemp>
    正在加载...
  </ng-template>

</ion-content>
<ion-footer *ngIf='modifyCredential'>
  <ion-button fill='clear' expand='block' color='danger' (click)='onRemoveCredential(modifyCredential)'>
    <span *ngIf='modifyCredential?.isAdd'>删除</span>
    <span *ngIf='!modifyCredential?.isAdd'>删除证件</span>
  </ion-button>
  <span class='line'>|</span>
  <ion-button fill='clear' expand='block' color='secondary' (click)='onSaveCredential(modifyCredential)'>
    <span *ngIf='modifyCredential?.isAdd'>保存</span>
    <span *ngIf='!modifyCredential?.isAdd'>修改信息</span>
  </ion-button>
</ion-footer>