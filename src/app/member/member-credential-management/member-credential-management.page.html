<ion-header>
  <ion-toolbar>
    <ion-buttons slot='start'>
      <ion-button color='dark' (click)='back()'>
        <ion-icon name='arrow-back'></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>证件管理</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh()">
    <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="下拉刷新" refreshingSpinner="circles"
      refreshingText="正在加载...">
    </ion-refresher-content>
  </ion-refresher>
  <form #f>
    <ng-container *ngIf='!loading else loadingTemp'>
      <ion-grid margin-top *ngFor='let c of credentials;' #modifyForm>
        <ion-row>
          <ion-col text-start>
            <ion-button fill='clear' color='danger' szie='small' (click)='removeExistCredential(c)'>
              <ion-text>删除证件</ion-text>
            </ion-button>
          </ion-col>
          <ion-col text-end>
            <ion-button fill='clear' *ngIf='isModify' color='secondary' szie='small'
              (click)='saveModify(c,modifyForm.el);togleModify(c)'>
              <ion-text>保存修改</ion-text>
            </ion-button>
            <ion-button *ngIf="!isModify" fill='clear' color='secondary' szie='small' (click)='togleModify(c)'>
              <ion-text>修改信息</ion-text>
            </ion-button>
          </ion-col>
        </ion-row>

        <div *ngIf='!isModify'>
          <ion-row>
            <ion-col>姓名：</ion-col>
            <ion-col>{{c.FirstName}}{{c.LastName}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>登机名：</ion-col>
            <ion-col>{{c.CheckName}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>性别：</ion-col>
            <ion-col>{{c.Gender=="M"?"男":"女"}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>证件类型：</ion-col>
            <ion-col>{{c.Type|credential}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>证件号码：</ion-col>
            <ion-col>{{c.Number}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>出生年月：</ion-col>
            <ion-col>{{c.Birthday}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>证件到期日期</ion-col>
            <ion-col>{{c.ExpirationDate}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>国籍</ion-col>
            <ion-col>{{c.Country}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col>发证国籍</ion-col>
            <ion-col>{{c.IssueCountry}}</ion-col>
          </ion-row>
        </div>
        <div [style.display]='!isModify?"none":"block"'>
          <ion-row>
            <ion-col>姓：</ion-col>
            <ion-col>
              <input type="text" [(ngModel)]='c.FirstName' (change)='dataModified(c)' ValidateName='FirstName'
                name='FirstName'>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>名：</ion-col>
            <ion-col>
              <input type="text" [(ngModel)]='c.LastName' (change)='dataModified(c)' ValidateName='LastName'
                name='LastName'>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>登机姓：</ion-col>
            <ion-col>
              <input type="text" [(ngModel)]='c.CheckFirstName' (change)='dataModified(c)' ValidateName='CheckFirstName'
                name='CheckFirstName'>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>登机名：</ion-col>
            <ion-col>
              <input type="text" [(ngModel)]='c.CheckLastName' (change)='dataModified(c)' ValidateName='CheckLastName'
                name='CheckLastName'>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>性别：</ion-col>
            <ion-col>
              <ion-radio-group no-margin no-padding [(ngModel)]='c.Gender' name='Gender' class='gender'
                (ionSelect)='dataModified(c)'>
                <ion-radio value="M" [checked]='c.Gender=="M"'></ion-radio>
                <ion-label slot='start'>男</ion-label>
                <ion-label margin-start padding-start></ion-label>
                <ion-radio value="F"></ion-radio>
                <ion-label>女</ion-label>
              </ion-radio-group>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col no-margin no-padding class="id-type">
              <ion-item lines='none' no-margin no-padding>
                <ion-label>证件类型</ion-label>
                <ion-select [(ngModel)]='c.Type' name='Type' okText="确定" cancelText="取消" [compareWith]='compareFn'>
                  <ion-select-option [value]="opt.key" *ngFor='let opt of identityTypes'>{{opt.key|credential}}
                  </ion-select-option>
                </ion-select>
                <input type="text" [attr.hidden]='!c.Type' ValidateName="Type">
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>证件号码：</ion-col>
            <ion-col>
              <input type="text" [(ngModel)]='c.Number' (change)='dataModified(c)' name='Number' ValidateName="Number">
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>出生年月：</ion-col>
            <ion-col>
              <input type="date" [(ngModel)]='c.Birthday' (change)='dataModified(c)' name='Birthday'
                ValidateName="Birthday">
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>证件到期日期</ion-col>
            <ion-col>
              <input type="date" [(ngModel)]='c.ExpirationDate' (change)='dataModified(c)' name='ExpirationDate'
                ValidateName="ExpirationDate">
            </ion-col>
          </ion-row>
          <ion-row (click)='selectIdentityNationality(c)'>
            <ion-col>
              <ion-label>国籍</ion-label>
            </ion-col>
            <ion-col text-center>
              <input type="text" text-end [class.validctrlsucess]='!!c.Country' readonly value="{{c.Country}}"
                name='Country' ValidateName="Country">
            </ion-col>
            <ion-col size='1' class='arrow-forward' text-end>
              <ion-icon name='arrow-forward' size='small' color='medium' mode='ios'></ion-icon>
            </ion-col>
          </ion-row>
          <ion-row (click)='selectIssueNationality(c)'>
            <ion-col>
              <ion-label>发证国籍</ion-label>
            </ion-col>
            <ion-col text-center>
              <input type="text" text-end [class.validctrlsucess]="!!c.IssueCountry" readonly value="{{c.IssueCountry}}"
                name='IssueCountry' ValidateName="IssueCountry">
            </ion-col>
            <ion-col size='1' class='arrow-forward' text-end>
              <ion-icon name='arrow-forward' size='small' color='medium' mode='ios'></ion-icon>
            </ion-col>
          </ion-row>
        </div>
      </ion-grid>
    </ng-container>
  </form>
  <ng-template #loadingTemp>
    正在加载...
  </ng-template>
  <!-- 新增证件 -->
  <ng-container *ngIf='newCredentials?.length'>
    <ion-grid margin-top *ngFor='let c of newCredentials;' #addForm>
      <ion-row>
        <ion-col>姓：</ion-col>
        <ion-col>
          <input type="text" [(ngModel)]='c.FirstName' ValidateName='FirstName' name='FirstName'>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>名：</ion-col>
        <ion-col>
          <input type="text" [(ngModel)]='c.LastName' ValidateName='LastName' name='LastName'>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>登机姓：</ion-col>
        <ion-col>
          <input type="text" [(ngModel)]='c.CheckFirstName' ValidateName='CheckFirstName' name='CheckFirstName'>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>登机名：</ion-col>
        <ion-col>
          <input type="text" [(ngModel)]='c.CheckLastName' ValidateName='CheckLastName' name='CheckLastName'>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>性别：</ion-col>
        <ion-col>
          <ion-radio-group no-margin no-padding [(ngModel)]='c.Gender' name='Gender' class='gender'>
            <ion-radio value="M" [checked]='c.Gender=="M"'></ion-radio>
            <ion-label slot='start'>男</ion-label>
            <ion-label margin-start padding-start></ion-label>
            <ion-radio value="F"></ion-radio>
            <ion-label>女</ion-label>
          </ion-radio-group>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col no-margin no-padding class="id-type">
          <ion-item lines='none' no-margin no-padding>
            <ion-label>证件类型</ion-label>
            <ion-select [(ngModel)]='c.Type' name='Type' okText="确定" cancelText="取消" [compareWith]='compareFn'>
              <ion-select-option [value]="opt.key" *ngFor='let opt of identityTypes'>{{opt.key|credential}}
              </ion-select-option>
            </ion-select>
            <input type="text" value="{{c.Type}}" hidden ValidateName="Type">
          </ion-item>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>证件号码：</ion-col>
        <ion-col>
          <input type="text" [(ngModel)]='c.Number' name='Number' ValidateName="Number">
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>出生年月：</ion-col>
        <ion-col>
          <input type="date" [(ngModel)]='c.Birthday' name='Birthday' ValidateName="Birthday">
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>证件到期日期</ion-col>
        <ion-col>
          <input type="date" [(ngModel)]='c.ExpirationDate' name='ExpirationDate' ValidateName="ExpirationDate">
        </ion-col>
      </ion-row>
      <ion-row (click)='selectIdentityNationality(c)'>
        <ion-col>
          <ion-label>国籍</ion-label>
        </ion-col>
        <ion-col text-center>
          <input type="text" text-end [class.validctrlsucess]='!!c.Country' readonly value="{{c.Country}}"
            name='Country' ValidateName="Country">
        </ion-col>
        <ion-col size='1' class='arrow-forward' text-end>
          <ion-icon name='arrow-forward' size='small' color='medium' mode='ios'></ion-icon>
        </ion-col>
      </ion-row>
      <ion-row (click)='selectIssueNationality(c)'>
        <ion-col>
          <ion-label>发证国籍</ion-label>
        </ion-col>
        <ion-col text-center>
          <input type="text" text-end [class.validctrlsucess]="!!c.IssueCountry" readonly value="{{c.IssueCountry}}"
            name='IssueCountry' ValidateName="IssueCountry">
        </ion-col>
        <ion-col size='1' class='arrow-forward' text-end>
          <ion-icon name='arrow-forward' size='small' color='medium' mode='ios'></ion-icon>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col text-center>
          <ion-button (click)='saveAdd(c,addForm.el)' color='secondary'>保存</ion-button>
        </ion-col>
        <ion-col text-center>
          <ion-button (click)='removeAdd(c)' color='secondary'>删除</ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-container>

  <ion-list (click)='addCredential()' no-padding padding-top padding-bottom>
    <ion-button fill='outline' expand='block' color='secondary'>
      <div class='item'>
        <ion-icon name="add-circle-outline"></ion-icon>
        <ion-label>新增</ion-label>
      </div>
    </ion-button>
  </ion-list>
</ion-content>